<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seed Data — Portal</title>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; max-width: 600px; margin: 60px auto; padding: 24px; color: #333; }
        h1 { font-size: 1.3rem; margin-bottom: 8px; }
        .status { padding: 12px 16px; border-radius: 8px; margin: 8px 0; font-size: 0.9rem; }
        .pending { background: #f5f5f5; color: #888; }
        .running { background: #eff6ff; color: #2563eb; }
        .done { background: #f0fdf4; color: #16a34a; }
        .error { background: #fef2f2; color: #dc2626; }
        button { padding: 12px 24px; background: #111; color: #fff; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; margin-top: 16px; }
        button:hover { background: #444; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        #log { margin-top: 24px; }
    </style>
</head>
<body>
    <h1>Seed Avance Care Invoices</h1>
    <p style="color:#888; font-size:0.9rem;">Sign in, then click the button to insert client + invoice records.</p>
    <button id="sign-in-btn" onclick="doSignIn()">Sign in with Google</button>
    <button id="seed-btn" onclick="doSeed()" disabled style="display:none;">Insert Invoice Data</button>
    <div id="log"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDocs, collection } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

        const app = initializeApp({
            apiKey: "AIzaSyB4pbBVj7Dryy3C57V2s6L4N_znGEyuib0",
            authDomain: "trip-planner-5cc84.firebaseapp.com",
            projectId: "trip-planner-5cc84",
            storageBucket: "trip-planner-5cc84.firebasestorage.app",
            messagingSenderId: "803115812045",
            appId: "1:803115812045:web:d49aa3df4ee4038c5fd584"
        });

        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        function log(msg, cls = 'done') {
            const el = document.createElement('div');
            el.className = 'status ' + cls;
            el.textContent = msg;
            document.getElementById('log').appendChild(el);
        }

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === 'mdulin@gmail.com') {
                document.getElementById('sign-in-btn').style.display = 'none';
                document.getElementById('seed-btn').style.display = 'inline-block';
                document.getElementById('seed-btn').disabled = false;
                log('Signed in as ' + user.email, 'done');
            }
        });

        window.doSignIn = async function() {
            try {
                await signInWithPopup(auth, provider);
            } catch (e) {
                log('Sign-in error: ' + e.message, 'error');
            }
        };

        function generateToken() {
            return Array.from(crypto.getRandomValues(new Uint8Array(24))).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        window.doSeed = async function() {
            const btn = document.getElementById('seed-btn');
            btn.disabled = true;
            btn.textContent = 'Working...';

            try {
                // ===== 1. Check if Avance Care client exists =====
                log('Checking for existing Avance Care client...', 'running');
                const clientSnap = await getDocs(collection(db, 'portal_clients'));
                const existing = clientSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                let avanceId = null;
                const avanceClient = existing.find(c =>
                    (c.company || '').toLowerCase().includes('avance')
                );

                if (avanceClient) {
                    avanceId = avanceClient.id;
                    log('Found existing Avance Care client: ' + avanceId, 'done');
                } else {
                    avanceId = 'client-avance-care';
                    const clientData = {
                        name: 'Avance Care',
                        company: 'Avance Care, P.A.',
                        email: '',
                        phone: '',
                        address1: '705 University Drive',
                        address2: 'Building 700',
                        city: 'Durham',
                        state: 'NC',
                        zip: '27707-3489',
                        contractStart: '2024-01-01',
                        contractEnd: '2025-12-31',
                        contractTerm: '1 year, auto-renews',
                        contractNotice: '30 days written notice to non-renew',
                        hourlyRate: 250,
                        minHoursPerWeek: 10,
                        invoiceFrequency: 'biweekly',
                        invoiceTerms: 'Net 30',
                        color: '#2563eb',
                        services: 'VBC/ACO consulting, population health, clinical program development, referral optimization, Epic-related training, CPA supervision',
                        nonSolicitation: '1 year post-term',
                        notes: '$250/hr, 10hr/week min, biweekly invoicing.\nIndependent contractor — responsible for own taxes.\nPractice provides malpractice insurance.\nServices: VBC, ACO, population health, clinical programs, referral optimization, CPA supervision.\n30 days notice to terminate. 1-year auto-renewing term.',
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_clients', avanceId), clientData);
                    log('Created Avance Care client', 'done');
                }

                // ===== 2. Check existing invoices to avoid duplicates =====
                log('Checking for existing invoices...', 'running');
                const invSnap = await getDocs(collection(db, 'portal_invoices'));
                const existingInvs = invSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                const existingNumbers = existingInvs.map(i => i.invoiceNumber);

                // ===== 3. Invoice 1097 =====
                if (existingNumbers.includes('1097') || existingNumbers.includes('INV-1097')) {
                    log('Invoice 1097 already exists — skipping', 'pending');
                } else {
                    const inv1097 = {
                        clientId: avanceId,
                        clientName: 'Avance Care',
                        clientEmail: '',
                        clientAddress1: '705 University Drive',
                        clientAddress2: 'Building 700',
                        clientCity: 'Durham',
                        clientState: 'NC',
                        clientZip: '27707-3489',
                        terms: 'Net 30',
                        invoiceNumber: '1097',
                        date: '2025-12-03',
                        dueDate: '2026-01-02',
                        status: 'paid',
                        paidAt: '2026-01-02T00:00:00.000Z',
                        paidMethod: 'ACH',
                        lineItems: [
                            { date: '2025-11-03', activity: 'Consulting Services - Population Health', description: 'Services for 11/3 - 11/7', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2025-11-10', activity: 'Consulting Services - Population Health', description: 'Services for 11/10 - 11/14', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2025-11-17', activity: 'Consulting Services - Population Health', description: 'Services for 11/17 - 11/21', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2025-11-24', activity: 'Consulting Services - Population Health', description: 'Services for 11/24 - 11/28', quantity: 10, rate: 250, amount: 2500 }
                        ],
                        total: 10000,
                        notes: '',
                        magicToken: generateToken(),
                        createdAt: '2025-12-03T00:00:00.000Z',
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_invoices', 'inv-1097'), inv1097);
                    log('Created Invoice 1097 — $10,000 (paid)', 'done');
                }

                // ===== 4. Invoice 1098 =====
                if (existingNumbers.includes('1098') || existingNumbers.includes('INV-1098')) {
                    log('Invoice 1098 already exists — skipping', 'pending');
                } else {
                    const inv1098 = {
                        clientId: avanceId,
                        clientName: 'Avance Care',
                        clientEmail: '',
                        clientAddress1: '705 University Drive',
                        clientAddress2: 'Building 700',
                        clientCity: 'Durham',
                        clientState: 'NC',
                        clientZip: '27707-3489',
                        terms: 'Net 30',
                        invoiceNumber: '1098',
                        date: '2026-01-03',
                        dueDate: '2026-02-02',
                        status: 'paid',
                        paidAt: '2026-02-02T00:00:00.000Z',
                        paidMethod: 'ACH',
                        lineItems: [
                            { date: '2025-12-01', activity: 'Consulting Services', description: 'VBC Support 12/1 - 12/5', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2025-12-08', activity: 'Consulting Services', description: 'VBC Support 12/8-12/12', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2025-12-15', activity: 'Consulting Services', description: 'VBC Support 12/15 - 12/19', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2025-12-22', activity: 'Consulting Services', description: 'VBC Support 12/22 - 12/26', quantity: 10, rate: 250, amount: 2500 }
                        ],
                        total: 10000,
                        notes: '',
                        magicToken: generateToken(),
                        createdAt: '2026-01-03T00:00:00.000Z',
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_invoices', 'inv-1098'), inv1098);
                    log('Created Invoice 1098 — $10,000 (paid)', 'done');
                }

                // ===== 5. Invoice 1099 =====
                if (existingNumbers.includes('1099') || existingNumbers.includes('INV-1099')) {
                    log('Invoice 1099 already exists — skipping', 'pending');
                } else {
                    const inv1099 = {
                        clientId: avanceId,
                        clientName: 'Avance Care',
                        clientEmail: '',
                        clientAddress1: '705 University Drive',
                        clientAddress2: 'Building 700',
                        clientCity: 'Durham',
                        clientState: 'NC',
                        clientZip: '27707-3489',
                        terms: 'Net 30',
                        invoiceNumber: '1099',
                        date: '2026-01-30',
                        dueDate: '2026-03-01',
                        status: 'paid',
                        paidAt: '2026-03-01T00:00:00.000Z',
                        paidMethod: 'ACH',
                        lineItems: [
                            { date: '2026-01-02', activity: 'Consulting Services', description: 'Services from 12/29/25 - 01/02/26', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2026-01-09', activity: 'Consulting Services', description: 'Services from 01/05/26 - 01/09/26', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2026-01-16', activity: 'Services', description: 'Services from 01/12/26-01/16/26', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2026-01-23', activity: 'Services', description: 'Services from 1/19/26 - 01/23/26', quantity: 10, rate: 250, amount: 2500 },
                            { date: '2026-01-30', activity: 'Services', description: 'Services from 01/26/26 - 01/30/26', quantity: 10, rate: 250, amount: 2500 }
                        ],
                        total: 12500,
                        notes: '',
                        magicToken: generateToken(),
                        createdAt: '2026-01-30T00:00:00.000Z',
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_invoices', 'inv-1099'), inv1099);
                    log('Created Invoice 1099 — $12,500 (paid)', 'done');
                }

                // ===== 6. Gray Matter Analytics client =====
                log('Checking for Gray Matter Analytics client...', 'running');
                let grayMatterId = null;
                const grayClient = existing.find(c =>
                    (c.company || '').toLowerCase().includes('gray matter')
                );

                if (grayClient) {
                    grayMatterId = grayClient.id;
                    log('Found existing Gray Matter Analytics client: ' + grayMatterId, 'done');
                } else {
                    grayMatterId = 'client-gray-matter';
                    const gmClientData = {
                        name: 'Sheila G. Talton, CEO',
                        company: 'Gray Matter Analytics, Inc.',
                        email: 'Contracts@graymatteranalytics.com',
                        phone: '312-957-7604',
                        address1: '180 N. Wabash Avenue',
                        address2: 'Suite 602',
                        city: 'Chicago',
                        state: 'IL',
                        zip: '60601',
                        contractStart: '2021-08-23',
                        contractEnd: '2025-08-22',
                        contractTerm: '12 months, auto-renews annually',
                        contractNotice: '30 days written notice to terminate',
                        hourlyRate: 250,
                        monthlyRetainer: 10000,
                        guaranteedHoursPerMonth: 40,
                        invoiceFrequency: 'bimonthly',
                        invoiceTerms: 'Net 30',
                        color: '#7c3aed',
                        services: 'CMO — Market strategy, client support/advisement, product/service/solution development, investment procurement, M&A strategy, clinical marketing (writing/speaking), business development',
                        nonCompete: 'During term only',
                        nonSolicitation: '1 year post-term (employees/contractors)',
                        notes: 'Title: Chief Medical Officer.\n$10,000/month flat for 40 guaranteed hours (whether worked or not).\nInvoice twice monthly, Net 30.\nTravel + pre-approved business expenses reimbursed.\nContractor must maintain $1M E&O insurance.\nWork product owned by company.\nIllinois law, Cook County jurisdiction.\n\nSTATUS: INACTIVE — outstanding $6,000 balance from March 2025 CMO services. $1,000 partial payment received 01/03/2026.',
                        status: 'inactive',
                        createdAt: '2021-08-23T00:00:00.000Z',
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_clients', grayMatterId), gmClientData);
                    log('Created Gray Matter Analytics client', 'done');
                }

                // ===== 7. Invoice 1095 (Gray Matter — overdue, partial payment) =====
                if (existingNumbers.includes('1095') || existingNumbers.includes('INV-1095')) {
                    log('Invoice 1095 already exists — skipping', 'pending');
                } else {
                    const inv1095 = {
                        clientId: grayMatterId,
                        clientName: 'Gray Matter Analytics',
                        clientEmail: '',
                        clientAddress1: '180 N. Wabash Avenue',
                        clientAddress2: 'Suite 602',
                        clientCity: 'Chicago',
                        clientState: 'IL',
                        clientZip: '60601',
                        terms: 'Net 30',
                        invoiceNumber: '1095',
                        date: '2025-03-31',
                        dueDate: '2025-04-30',
                        status: 'overdue',
                        lineItems: [
                            { date: '2025-03-31', activity: 'Services', description: 'Consulting services / CMO', quantity: 1, rate: 7000, amount: 7000 }
                        ],
                        total: 7000,
                        amountPaid: 1000,
                        payments: [
                            { date: '2026-01-03', amount: 1000, method: 'ACH', note: 'Partial payment' }
                        ],
                        notes: 'Consulting services / CMO completed March 2025. Originally due April 30, 2025. Re-invoiced October 20, 2025. $1,000 partial payment received 01/03/2026. Remaining balance: $6,000.',
                        magicToken: generateToken(),
                        createdAt: '2025-03-31T00:00:00.000Z',
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_invoices', 'inv-1095'), inv1095);
                    log('Created Invoice 1095 — $7,000 (overdue, $1,000 paid, $6,000 remaining)', 'done');
                }

                // ===== 8. Generations Family Practice client =====
                log('Checking for Generations Family Practice client...', 'running');
                let generationsId = null;
                const genClient = existing.find(c =>
                    (c.company || '').toLowerCase().includes('generation') ||
                    (c.company || '').toLowerCase().includes('triad primary')
                );

                if (genClient) {
                    generationsId = genClient.id;
                    log('Found existing Generations Family Practice client: ' + generationsId, 'done');
                } else {
                    generationsId = 'client-generations';
                    const genClientData = {
                        name: 'Dr. Alex Tse',
                        company: 'Generations Family Practice, PA (DBA Triad Primary Care)',
                        email: '',
                        phone: '',
                        address1: '1309 Lees Chapel Rd',
                        address2: '',
                        city: 'Greensboro',
                        state: 'NC',
                        zip: '27455',
                        contractStart: '2025-01-01',
                        contractEnd: '2025-12-31',
                        contractTerm: '1 year, auto-renews',
                        contractNotice: '30 days notice to non-renew',
                        hourlyRate: 150,
                        maxHoursPerWeek: 16,
                        invoiceFrequency: 'monthly',
                        invoiceTerms: 'Net 10',
                        color: '#16a34a',
                        services: 'In-clinic patient-facing hours, family medicine, CIN/ACO/IPA participation',
                        nonCompete: '18 months, 10-mile radius from primary office',
                        nonSolicitation: 'During term + post-term (patients, providers, employees)',
                        notes: '$150/hr, up to 16hrs/week in-clinic patient-facing.\nLocation: 1309 Lees Chapel Rd, Greensboro, NC 27455.\nMon-Fri 8am-5pm. Monthly invoicing — validated first 5 days, paid within 10 days.\nMust complete charts within 2 days of service.\nContact: Dr. Alex Tse, CMM Medical Director.\nNon-compete: 18 months, 10-mile radius.\n1-year auto-renewing term, 30 days notice.',
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_clients', generationsId), genClientData);
                    log('Created Generations Family Practice client', 'done');
                }

                // ===== 9. Invoice 1100 — Generations Dec 2025 =====
                if (existingNumbers.includes('1100') || existingNumbers.includes('INV-1100')) {
                    log('Invoice 1100 already exists — skipping', 'pending');
                } else {
                    const inv1100 = {
                        clientId: generationsId,
                        clientName: 'Dr. Alex Tse',
                        clientEmail: '',
                        clientAddress1: '1309 Lees Chapel Rd',
                        clientAddress2: '',
                        clientCity: 'Greensboro',
                        clientState: 'NC',
                        clientZip: '27455',
                        terms: 'Net 10',
                        invoiceNumber: '1100',
                        date: '2025-12-29',
                        dueDate: '2026-01-08',
                        status: 'paid',
                        paidAt: '2026-01-08T00:00:00.000Z',
                        lineItems: [
                            { date: '2025-12-02', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 },
                            { date: '2025-12-03', activity: 'Consulting', description: '6.0 hours @ $150/hr', quantity: 6.0, rate: 150, amount: 900 },
                            { date: '2025-12-08', activity: 'Consulting', description: '6.0 hours @ $150/hr', quantity: 6.0, rate: 150, amount: 900 },
                            { date: '2025-12-09', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 },
                            { date: '2025-12-10', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 },
                            { date: '2025-12-15', activity: 'Consulting', description: '9.0 hours @ $150/hr', quantity: 9.0, rate: 150, amount: 1350 },
                            { date: '2025-12-16', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 },
                            { date: '2025-12-17', activity: 'Consulting', description: '5.0 hours @ $150/hr', quantity: 5.0, rate: 150, amount: 750 },
                            { date: '2025-12-18', activity: 'Consulting', description: '9.0 hours @ $150/hr', quantity: 9.0, rate: 150, amount: 1350 },
                            { date: '2025-12-26', activity: 'Consulting', description: '6.0 hours @ $150/hr', quantity: 6.0, rate: 150, amount: 900 },
                            { date: '2025-12-29', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 }
                        ],
                        total: 12150,
                        amountPaid: 12150,
                        notes: 'Generations Family Practice — December 2025 contractor hours. 81.0 total hours at $150/hr. Signed 12/29/2025.',
                        magicToken: generateToken(),
                        createdAt: '2025-12-29T00:00:00.000Z',
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_invoices', 'inv-1100'), inv1100);
                    log('Created Invoice 1100 — Generations Dec 2025, $12,150 (paid)', 'done');
                }

                // ===== 10. Invoice 1101 — Generations Jan 2026 =====
                if (existingNumbers.includes('1101') || existingNumbers.includes('INV-1101')) {
                    log('Invoice 1101 already exists — skipping', 'pending');
                } else {
                    const inv1101 = {
                        clientId: generationsId,
                        clientName: 'Dr. Alex Tse',
                        clientEmail: '',
                        clientAddress1: '1309 Lees Chapel Rd',
                        clientAddress2: '',
                        clientCity: 'Greensboro',
                        clientState: 'NC',
                        clientZip: '27455',
                        terms: 'Net 10',
                        invoiceNumber: '1101',
                        date: '2026-01-28',
                        dueDate: '2026-02-07',
                        status: 'paid',
                        paidAt: '2026-02-07T00:00:00.000Z',
                        lineItems: [
                            { date: '2026-01-09', activity: 'Consulting', description: '9.0 hours @ $150/hr', quantity: 9.0, rate: 150, amount: 1350 },
                            { date: '2026-01-12', activity: 'Consulting', description: '9.0 hours @ $150/hr', quantity: 9.0, rate: 150, amount: 1350 },
                            { date: '2026-01-13', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 },
                            { date: '2026-01-14', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 },
                            { date: '2026-01-19', activity: 'Consulting', description: '9.0 hours @ $150/hr', quantity: 9.0, rate: 150, amount: 1350 },
                            { date: '2026-01-20', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 },
                            { date: '2026-01-21', activity: 'Consulting', description: '9.0 hours @ $150/hr', quantity: 9.0, rate: 150, amount: 1350 },
                            { date: '2026-01-27', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 },
                            { date: '2026-01-28', activity: 'Consulting', description: '8.0 hours @ $150/hr', quantity: 8.0, rate: 150, amount: 1200 }
                        ],
                        total: 11400,
                        amountPaid: 11400,
                        notes: 'Generations Family Practice — January 2026 contractor hours. 76.0 total hours at $150/hr.',
                        magicToken: generateToken(),
                        createdAt: '2026-01-28T00:00:00.000Z',
                        updatedAt: new Date().toISOString()
                    };
                    await setDoc(doc(db, 'portal_invoices', 'inv-1101'), inv1101);
                    log('Created Invoice 1101 — Generations Jan 2026, $11,400 (paid)', 'done');
                }

                log('All done! You can close this page and check the portal.', 'done');
                btn.textContent = 'Done';
            } catch (e) {
                log('Error: ' + e.message, 'error');
                btn.disabled = false;
                btn.textContent = 'Retry';
            }
        };
    </script>
</body>
</html>
